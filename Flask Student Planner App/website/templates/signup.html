{% extends "base.html" %}

{% block title %}Sign Up{% endblock %}

{% block content %}
<div class="container py-5 d-flex justify-content-center align-items-center min-vh-100">
    <div class="card shadow-lg border-0 p-4" style="max-width: 500px; width: 100%;">
        <h3 class="text-center text-primary mb-4">Sign Up</h3>
        <form method="POST" id="signupForm">
            <!-- Email Field -->
            <div class="form-group mb-3 position-relative">
                <label for="email" class="form-label fw-bold">Email</label>
                <div class="input-group">
                    <input
                        type="email"
                        class="form-control rounded-pill"
                        id="email"
                        name="email"
                        placeholder="example@gmail.com"
                        required
                    />
                </div>
            </div>

            <!-- Full Name Field -->
            <div class="form-group mb-3 position-relative">
                <label for="fullname" class="form-label fw-bold">Full Name</label>
                <div class="input-group">
                    <input
                        type="text"
                        class="form-control rounded-pill"
                        id="fullname"
                        name="fullname"
                        placeholder="Full Name"
                        required
                    />
                </div>
            </div>

            <!-- Password Field -->
            <div class="form-group mb-3 position-relative">
                <label for="password1" class="form-label fw-bold">Password</label>
                <div class="input-group">
                    <input
                        type="password"
                        class="form-control rounded-pill"
                        id="password1"
                        name="password1"
                        placeholder="Enter Password"
                        required
                    />
                    <span class="position-absolute end-0 me-5 top-50 translate-middle-y" style="cursor: pointer;">
                        <i class="fas fa-eye" id="togglePassword1"></i>
                    </span>
                </div>
            </div>

            <!-- Confirm Password Field -->
            <div class="form-group mb-4 position-relative">
                <label for="password2" class="form-label fw-bold">Confirm Password</label>
                <div class="input-group">
                    <input
                        type="password"
                        class="form-control rounded-pill"
                        id="password2"
                        name="password2"
                        placeholder="Confirm Password"
                        required
                    />
                    <span class="position-absolute end-0 me-5 top-50 translate-middle-y" style="cursor: pointer;">
                        <i class="fas fa-eye" id="togglePassword2"></i>
                    </span>
                </div>
            </div>

            <!-- Submit Button -->
            <div class="d-grid gap-2">
                <button
                    type="submit"
                    id="signupButton"
                    class="btn btn-primary rounded-pill btn-lg d-flex align-items-center justify-content-center"
                >
                    <span>Sign Up</span>
                    <span id="spinner" class="spinner-border spinner-border-sm text-light ms-2 d-none" role="status" aria-hidden="true"></span>
                </button>
            </div>

            <!-- Login Link -->
            <div class="text-center mt-3">
                <span class="text-muted">Have an account already?</span>
                <a href="{{ url_for('auth.login') }}" class="text-primary fw-bold">Login</a>
            </div>
        </form>
    </div>
</div>

<!-- JavaScript -->
<script>
    document.addEventListener("DOMContentLoaded", function () {
        const emailInput = document.getElementById("email");
        const password1Input = document.getElementById("password1");
        const password2Input = document.getElementById("password2");
        const signupButton = document.getElementById("signupButton");
        const spinner = document.getElementById("spinner");
        const togglePassword1 = document.getElementById("togglePassword1");
        const togglePassword2 = document.getElementById("togglePassword2");

        // Email Validation
        emailInput.addEventListener("input", function () {
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (emailRegex.test(emailInput.value)) {
                emailInput.classList.remove("is-invalid");
                emailInput.classList.add("is-valid");
            } else {
                emailInput.classList.remove("is-valid");
                emailInput.classList.add("is-invalid");
            }
        });

        // Password Validation
        password1Input.addEventListener("input", function () {
            if (password1Input.value.length >= 6) {
                password1Input.classList.remove("is-invalid");
                password1Input.classList.add("is-valid");
            } else {
                password1Input.classList.remove("is-valid");
                password1Input.classList.add("is-invalid");
            }
        });

        // Confirm Password Validation
        password2Input.addEventListener("input", function () {
            if (password2Input.value === password1Input.value && password2Input.value.length >= 6) {
                password2Input.classList.remove("is-invalid");
                password2Input.classList.add("is-valid");
            } else {
                password2Input.classList.remove("is-valid");
                password2Input.classList.add("is-invalid");
            }
        });

        // Toggle Password Visibility
        togglePassword1.addEventListener("click", function () {
            const isPasswordVisible = password1Input.getAttribute("type") === "text";
            password1Input.setAttribute("type", isPasswordVisible ? "password" : "text");
            togglePassword1.classList.toggle("fa-eye", isPasswordVisible);
            togglePassword1.classList.toggle("fa-eye-slash", !isPasswordVisible);
        });

        togglePassword2.addEventListener("click", function () {
            const isPasswordVisible = password2Input.getAttribute("type") === "text";
            password2Input.setAttribute("type", isPasswordVisible ? "password" : "text");
            togglePassword2.classList.toggle("fa-eye", isPasswordVisible);
            togglePassword2.classList.toggle("fa-eye-slash", !isPasswordVisible);
        });

        // Add Spinner on Sign Up Button Click
        signupButton.addEventListener("click", function (e) {
            const isEmailValid = emailInput.classList.contains("is-valid");
            const isPassword1Valid = password1Input.classList.contains("is-valid");
            const isPassword2Valid = password2Input.classList.contains("is-valid");

            if (!isEmailValid || !isPassword1Valid || !isPassword2Valid) {
                e.preventDefault();
                return;
            }

            spinner.classList.remove("d-none");
        });
    });
</script>
{% endblock %}
